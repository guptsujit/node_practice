<!DOCTYPE html>
<html>

<head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <title>Hello world</title>
</head>

<body>Chat Box</body>

<div id="messageWrapper" style="width:300px;height:300px;background-color:bisque">

</div>

</html>
<br></br>

<div>
    <textarea rows="4" cols="25" id="messagebox"></textarea>
</div>
<br>
<div id="typingWrapper">

</div>
<br>
<div id="nameWrapper" style="width:200px;height:50px;background-color:green">

</div>
</br>
<div>
    <input type="text" name="name" id="name" placeholder="enter your name">
    <input type="button" value="Submit" id="addname">
</div>

</html>
<script src="/socket.io/socket.io.js"></script>
<script>
    const socket = io();
    socket.on('connect', () => {
        console.log('connected to server');

        socket.on('disconnect', () => {
            console.log('disconnected....')
        })
        $("#messagebox").keyup(function (e) {

            if ($('#messagebox').val() != '') {
                socket.emit('typing', $('#nameWrapper').html() + '  is typing....');
            } else {
                socket.emit('typingStopped', true);
            }

            if (e.which == 13 && $('#messagebox').val() != '') {
                socket.emit('newMessage', $('#messagebox').val(), $('#nameWrapper').html());
                $('#messagebox').val('');

            }

        })

        $("#messagebox").focus(function () {
            if ($('#messagebox').val() == '') {

            }
        })
        // user is typing event
        socket.on('userStoppedTyping', (condition) => {
            if (condition) {
                $('#typingWrapper').html('');
            }

        })

        // user is typing event
        socket.on('usertyping', (message) => {
            $('#typingWrapper').html(message);

        })

        socket.on('sendMessage', (message, username, userTyped) => {
            $('#messageWrapper').append(username + ' : ' + (message + "<br>"));
            if (userTyped) {
                $('#typingWrapper').html('');
            }
        })


    })



    $(document).ready(function () {
        $('#addname').on('click', function () {

            $('#nameWrapper').html($('#name').val());
            $('#name').val('');
        })
    })

</script>